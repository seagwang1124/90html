<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>통큰통독-26일차</title>
  <link rel="apple-touch-icon" type="image/png" href="https://i.postimg.cc/Qtnq0gFJ/Ezra-icon.png">
  <meta name="apple-mobile-web-app-title" content="통큰통독">
  <link rel="shortcut icon" type="image/png" href="https://i.postimg.cc/Qtnq0gFJ/Ezra-icon.png">
  <link rel="mask-icon" type="image/png" href="https://i.postimg.cc/Qtnq0gFJ/Ezra-icon.png">

  <style>
    /* ---------------------------
       전체 스타일 (원 디자인 유지)
       --------------------------- */
    :root{
      --blue:#007BFF;
      --pink:#ff99cc;
      --shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html,body { height:100%; margin:0; padding:0; font-family: Arial, sans-serif; -webkit-font-smoothing:antialiased; }
    body { padding-top:150px; background:#fdfdf8; color:#222; }

    a:link { color:#0000FF; } a:visited{ color:#660099; }

    /* 상단 고정 테이블 */
    .top-fixed-table {
      position: fixed; top:0; left:0; width:100%; background:transparent; border-bottom:none; z-index:100;
      table-layout: fixed; padding:10px 0; box-sizing:border-box;
    }
    .search-cell { text-align:left; padding-left:10px; vertical-align:top; width:30%; }
    .search-cell input[type="text"]{ width:50%; font-size:12pt; }
    .search-cell input[type="submit"], .search-cell input[type="reset"]{ font-size:10pt; padding:5px 8px; height:auto; }

    .audio-cell { text-align:right; padding-right:50px; vertical-align:top; width:30%; }
    #custom-audio-player { display:flex; flex-direction:column; align-items:center; }
    .player-controls{ display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:5px; }
    .time-display{ font-size:16px; font-weight:bold; color:black; margin:0 5px; min-width:44px; text-align:center; }

    .progress-container { display: flex; align-items: center; justify-content: center; gap: 6px; margin: 6px 0; }
    .skip-btn { width: 48px; height: 28px; font-size: 13px; cursor: pointer; border: 1px solid #ccc; border-radius: 5px; background: #fff; }
    .skip-btn:hover { background: #e0e0e0; }

    .control-btn{ width:28px; height:28px; font-size:14px; cursor:pointer; border:1px solid #ccc; background:#fff; border-radius:5px; }
    .control-btn:hover{ background:#e0e0e0; }
    #play-btn{ background:#d1f3d4; } #pause-btn{ background:#fff6d6; } #stop-btn{ background:#fddddd; }

    .speed-controls{ display:flex; align-items:center; justify-content:center; gap:5px; margin-bottom:5px; }
    .speed-btn{ width:21px; height:21px; font-size:10px; cursor:pointer; border:1px solid #ccc; border-radius:3px; background:#fff; }
    .speed-btn:hover{ background:#e0e0e0; }
    .speed-display{ font-weight:bold; color:var(--blue); width:50px; text-align:center; }

    .volume-control{ display:flex; align-items:center; justify-content:center; gap:5px; }
    input[type="range"]{ -webkit-appearance:none; width:160px; height:5px; background:#d3d3d3; outline:none; opacity:0.9; transition:opacity .2s; border-radius:3px;}
    input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:15px; height:15px; background:var(--blue); border-radius:50%; cursor:pointer; }

    /* progress */
    #progress-bar { width: 60%; max-width: 100px; }

    /* volume */
    #volume-slider { width: 80%; max-width: 120px; }

    /* 설명 버튼 컨테이너 (플로팅) */
    .explanation-button-container{ position:fixed; top:100px; left:30%;  transform:translateX(-50%);  padding:0 10px; transition:top .2s ease,left .2s ease,transform .2s ease; }
    .explanation-button-wrapper{ position:relative; display:inline-block; cursor:pointer; }
    .explanation-icon-button{ width:50px; height:50px; border-radius:50%; background:var(--pink); box-shadow:var(--shadow); border:none; display:flex; align-items:center; justify-content:center; font-size:40px; z-index:2; }
    .explanation-sub-buttons{ display:flex; flex-direction:column; gap:10px; opacity:0; visibility:hidden; transition:opacity .3s ease,visibility .3s ease, transform .3s ease; position:absolute; left:45%; transform:translateX(-50%) translateY(25px); z-index:1; }
    .explanation-button-wrapper.active .explanation-sub-buttons{ opacity:1; visibility:visible; transform:translateX(-50%) translateY(0); }
    .explanation-sub-button{ padding:5px 10px; font-size:18px; background:var(--pink); border:none; border-radius:5px; cursor:pointer; box-shadow:var(--shadow); white-space:nowrap; }
    .explanation-sub-button:hover{ transform:scale(1.03); }

    /* 폰트 사이즈 및 본문 요약 버튼 (항상 표시) */
    .container{ width:100%; text-align:center; margin-top:8px; }
    .font-size-label{ font-size:20px !important; margin-right:12px; font-weight:bold; color:blue; display:inline-block; vertical-align:middle; }
    #font-size{ font-size:20px !important; margin:0 8px; font-weight:bold; color:red; display:inline-block; vertical-align:middle; width:48px; }
    #down,#up{ width:27px; height:27px; font-size:20px; color:red; background:#fff; border:1px solid #ccc; border-radius:5px; cursor:pointer; display:inline-block; vertical-align:middle; }

    /* 본문 요약 버튼 - 항상 노출 (요구사항) */
    .summary-buttons { display:inline-block; margin-left:16px; vertical-align:middle; }
    .summary-btn { padding:6px 10px; margin-left:6px; font-size:14px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer; }
    .summary-btn:hover{ background:#f2f2f2; }

    /* 본문 */
    h2{ padding:0; text-align:left; margin-left:15px; margin-right:15px; }
    p{ display:inline-block; }


    /*본문 중앙 색상*/
    .highlight { background-color: #fdf6e3;    /* 연한 베이지 톤 (눈부심 최소화) */
    -webkit-text-stroke:0.2px #76d6c6;
     border-left: 4px solid #c0a060; /* 옆에 차분한 금색 포인트 */
     font-weight:bold;
     box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
     padding: 2px 6px;
    }
  
/* 📖 구절설명 버튼: 기본은 숨김, 화면 기준 고정 배치 */
#explanation-button-container{
  position:fixed;          /* ← viewport 기준: 문서 가로 스크롤 유발 방지 */
  z-index:150;             /* 모달(z-index:200)보다 낮음 */
  display:block;            /* 선택 시에만 보이도록 */
}

/* 모달이 열려 있으면 책 버튼은 숨김 (겹침/오해 방지) */
body.modal-open #explanation-button-container{
  display:none !important;
}
  
  
  /* 모달 */
.modal{
  display:none;
  position:fixed;
  z-index:200;
  inset:0;
  width:100%;
  height:100%;
  /* 오버레이는 스크롤 금지 */
  background:rgba(0,0,0,0.4);
}

.modal-content{
  background:#fff;
  margin:12% auto;
  padding:20px;
  border-radius:10px;
  width:80%;
  max-width:900px;
  /* ✅ 모달 내부에만 스크롤바가 생기도록 */
  max-height:80vh;
  overflow:auto;
  /* ✅ 모달 끝에서 바깥으로 스크롤 전파 방지 */
  overscroll-behavior:contain;

  box-shadow:0 4px 8px rgba(0,0,0,0.2);
  text-align:left;
  line-height:1.6;
  word-break:keep-all;
  white-space:pre-wrap;
}

/* ✅ 모달 열릴 때 바깥(본문) 스크롤 잠금 */
body.modal-open{ overflow:hidden; }


    /* 로딩 스피너 */
    .loader{ border:4px solid #f3f3f3; border-top:4px solid #3498db; border-radius:50%; width:20px; height:20px; animation:spin 1s linear infinite; display:inline-block; vertical-align:middle; margin-right:8px; }
    @keyframes spin{ 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

    /* 스크롤 마커 */
    .search-highlight{ background:yellow; color:#000; }
    .scroll-marker-container{ position:fixed; top:0; right:0; width:8px; height:100vh; z-index:99; pointer-events:none; }
    .scroll-marker{ position:absolute; right:0; width:8px; height:8px; background:red; border-radius:50%; box-shadow:0 0 5px rgba(255,0,0,0.7); cursor:pointer; pointer-events:auto; }
    .scroll-marker:hover{ transform:scale(1.5); transition:transform .2s ease; }

    /* 선택 관련 (iOS) */
    #bible-text{ -webkit-user-select:text; user-select:text; -webkit-touch-callout:none; }

    /* 반응형 보완 */
    @media (max-width:800px){
      .search-cell{ width:55%; } .audio-cell{ width:45%; } .search-cell input[type="text"]{ width:60%; } #progress-bar{ width:160px; }
    }
    @media (max-width:600px){
      .search-cell input[type="text"]{ width:68%; font-size:11pt; } .time-display{ font-size:13px; } #progress-bar{ width:140px; }
      .explanation-sub-button{ font-size:16px; padding:6px 8px; }
      .explanation-icon-button{ width:46px; height:46px; font-size:34px; }
      .summary-btn{ padding:5px 8px; font-size:13px; }
    }

     /* --- 새 버튼 그룹 스타일 --- */
    .toggle-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 6px;
    }
    .toggle-buttons button {
      padding: 4px 8px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: #fff;
      cursor: pointer;
    }
    .toggle-buttons button:hover {
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <!-- 상단: 검색 + 오디오 -->
  <table class="top-fixed-table" id="main-table" cellpadding="0" cellspacing="0">
    <tr>
      <td class="search-cell">
        <form name="f1" action="">
          <input type="reset" name="b2" value="X">
          <input type="text" placeholder="검색어를 입력하세요" name="t1" value="">
          <input type="submit" name="b1" value="검색">
          <div id="search-count-container">
            <span id="search-count"></span>
            <button type="button" id="next-location-btn" style="display:none;">다음 위치</button>
          </div>
        </form>
      </td>
      
       <td class="audio-cell">
        <div id="custom-audio-player" role="region" aria-label="오디오 플레이어">
          <audio id="audio-file" preload="auto" playsinline>
            <source src="https://vod47.anyline.co.kr/vod_ezra/%EC%9D%BD%EA%B8%B0%2026.mp3" type="audio/mpeg">
            브라우저가 오디오 요소를 지원하지 않습니다.
          </audio>

          <!-- 기본 컨트롤 -->
          <div class="player-controls">
            <strong><span style="font-size:16px; background-color: #fcfcfc;" id="current-time" class="time-display">0:00</span></strong>
            <button id="play-btn" class="control-btn" aria-label="재생">▶</button>
            <button id="pause-btn" class="control-btn" aria-label="일시정지">⏸</button>
            <button id="stop-btn" class="control-btn" aria-label="정지">■</button>
            <strong><span style="font-size:16px; background-color: #fcfcfc;" id="remaining-time" class="time-display">0:00</span></strong>
          </div>

          <!-- ✅ 새 버튼 그룹 -->
          <div class="toggle-buttons">
            <button id="show-progress">재생 위치</button>
            <button id="show-speed">재생 속도</button>
            <button id="show-volume">볼륨 조절</button>
          </div>

          <!-- 기본은 숨김 -->
          <div class="progress-container" style="display:none;">
            <button id="rewind-10" class="skip-btn">⏪10s</button>
            <input type="range" id="progress-bar" min="0" max="100" value="0" step="0.01" aria-label="재생 위치">
            <button id="forward-10" class="skip-btn">10s⏩</button>
          </div>

          <div class="speed-controls" style="display:none;">
            <button id="speed-down-02" class="speed-btn">&laquo;</button>
            <button id="speed-down-01" class="speed-btn">&lt;</button>
            <span id="speed-display" class="speed-display">1.0x</span>
            <button id="speed-up-01" class="speed-btn">&gt;</button>
            <button id="speed-up-02" class="speed-btn">&raquo;</button>
            <button id="speed-reset">1.0</button>
          </div>

          <div class="volume-control" style="display:none;">
            <span style="font-size:14px;">볼륨</span>
            <button id="mute-btn">🔊</button>
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
          </div>
        </div>
      </td>
    </tr>
  </table>

  <!-- 플로팅 책 버튼 (구절설명 토글) -->
  <div class="explanation-button-container" id="explanation-button-container">
    <div class="explanation-button-wrapper" id="explanation-button-wrapper">
      <button class="explanation-icon-button" id="explanation-icon-button" aria-label="구절설명 열기" title="단어나 문장을 선택하면 ‘간단설명’ 또는 ‘상세설명’을 볼 수 있어요.">
        <span>📖</span>
      </button>
      <div class="explanation-sub-buttons" id="explanation-sub-buttons" role="menu">
        <button class="explanation-sub-button" id="detailed-explanation-button">상세 구절설명</button>
        <button class="explanation-sub-button" id="simple-explanation-button">간단 구절설명</button>
      </div>
    </div>
  </div>

  <!-- 폰트 크기 + 항상 표시되는 본문 요약 버튼 -->
  <div class="container" style="margin-top:6px;">
    <p class="font-size-label">Font Size</p>
    <button id="down">-</button>
    <p id="font-size">20</p>
    <button id="up">+</button>

    <span class="summary-buttons" aria-hidden="false">
      <button class="summary-btn" id="summary-simple-main">본문요약 간단</button>
      <button class="summary-btn" id="summary-detailed-main">본문요약 상세</button>
    </span>
  </div>

  <!-- 본문 (원문 유지: <br></br> 포함) -->
  <div>
    <h2 id="bible-text" style="line-height:1.2em;margin-left:15px;margin-right:15px;font-style:normal;font-weight:normal;color:black;font-size:20px;word-break:break-all;">
   <strong>

통독 26일차
<br>범위: 시 14,16,17, 22,25,26,27,28, 31,35,36,38, 40,41,53,55편</br></strong>
<br>&nbsp;</br>
  

<strong><br><font color="#4682b4">시편 14 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시, 인도자를 따라 부르는 노래*</font></i></br>
<br>1 어리석은 자는 그의 마음에 이르기를 하나님이 없다 하는도다 그들은 부패하고 그 행실이 가증하니 선을 행하는 자가 없도다</br>
<br>2 여호와께서 하늘에서 인생을 굽어살피사 지각이 있어 하나님을 찾는 자가 있는가 보려 하신즉</br>
<br>3 다 치우쳐 함께 더러운 자가 되고 선을 행하는 자가 없으니 하나도 없도다</br>
<br>4 죄악을 행하는 자는 다 무지하냐 그들이 떡 먹듯이 내 백성을 먹으면서 여호와를 부르지 아니하는도다</br>
<br>5 그러나 거기서 그들은 두려워하고 두려워하였으니 하나님이 의인의 세대에 계심이로다</br>
<br>6 너희가 가난한 자의 계획을 부끄럽게 하나 오직 여호와는 그의 피난처가 되시도다</br>
<br>7 이스라엘의 구원이 시온에서 나오기를 원하도다 여호와께서 그의 백성을 포로된 곳에서 돌이키실 때에 야곱이 즐거워하고 이스라엘이 기뻐하리로다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 16 편</font></br></strong>
<br><i><font color="#808080">*다윗의 믹담*</font></i></br>
<br>1 하나님이여 나를 지켜 주소서 내가 주께 피하나이다</br>
<br>2 내가 여호와께 아뢰되 주는 나의 주님이시오니 주 밖에는 나의 복이 없다 하였나이다</br>
<br>3 땅에 있는 성도들은 존귀한 자들이니 나의 모든 즐거움이 그들에게 있도다</br>
<br>4 다른 신에게 예물을 드리는 자는 괴로움이 더할 것이라 나는 그들이 드리는 피의 전제를 드리지 아니하며 내 입술로 그 이름도 부르지 아니하리로다</br>
<br>5 여호와는 나의 산업과 나의 잔의 소득이시니 나의 분깃을 지키시나이다</br>
<br>6 내게 줄로 재어 준 구역은 아름다운 곳에 있음이여 나의 기업이 실로 아름답도다</br>
<br>7 나를 훈계하신 여호와를 송축할지라 밤마다 내 양심이 나를 교훈하도다</br>
<br>8 내가 여호와를 항상 내 앞에 모심이여 그가 나의 오른쪽에 계시므로 내가 흔들리지 아니하리로다</br>
<br>9 이러므로 나의 마음이 기쁘고 나의 영도 즐거워하며 내 육체도 안전히 살리니</br>
<br>10 이는 주께서 내 영혼을 스올에 버리지 아니하시며 주의 거룩한 자를 멸망시키지 않으실 것임이니이다</br>
<br>11 주께서 생명의 길을 내게 보이시리니 주의 앞에는 충만한 기쁨이 있고 주의 오른쪽에는 영원한 즐거움이 있나이다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 17 편</font></br></strong>
<br><i><font color="#808080">*다윗의 기도*</font></i></br>
<br>1 여호와여 의의 호소를 들으소서 나의 울부짖음에 주의하소서 거짓 되지 아니한 입술에서 나오는 나의 기도에 귀를 기울이소서</br>
<br>2 주께서 나를 판단하시며 주의 눈으로 공평함을 살피소서</br>
<br>3 주께서 내 마음을 시험하시고 밤에 내게 오시어서 나를 감찰하셨으나 흠을 찾지 못하셨사오니 내가 결심하고 입으로 범죄하지 아니하리이다</br>
<br>4 사람의 행사로 논하면 나는 주의 입술의 말씀을 따라 스스로 삼가서 포악한 자의 길을 가지 아니하였사오며</br>
<br>5 나의 걸음이 주의 길을 굳게 지키고 실족하지 아니하였나이다</br>
<br>6 하나님이여 내게 응답하시겠으므로 내가 불렀사오니 내게 귀를 기울여 내 말을 들으소서</br>
<br>7 주께 피하는 자들을 그 일어나 치는 자들에게서 오른손으로 구원하시는 주여 주의 기이한 사랑을 나타내소서</br>
<br>8 나를 눈동자 같이 지키시고 주의 날개 그늘 아래에 감추사</br>
<br>9 내 앞에서 나를 압제하는 악인들과 나의 목숨을 노리는 원수들에게서 벗어나게 하소서</br>
<br>10 그들의 마음은 기름에 잠겼으며 그들의 입은 교만하게 말하나이다</br>
<br>11 이제 우리가 걸어가는 것을 그들이 에워싸서 노려보고 땅에 넘어뜨리려 하나이다</br>
<br>12 그는 그 움킨 것을 찢으려 하는 사자 같으며 은밀한 곳에 엎드린 젊은 사자 같으니이다</br>
<br>13 여호와여 일어나 그를 대항하여 넘어뜨리시고 주의 칼로 악인에게서 나의 영혼을 구원하소서</br>
<br>14 여호와여 이 세상에 살아 있는 동안 그들의 분깃을 받은 사람들에게서 주의 손으로 나를 구하소서 그들은 주의 재물로 배를 채우고 자녀로 만족하고 그들의 남은 산업을 그들의 어린 아이들에게 물려 주는 자니이다</br>
<br>15 나는 의로운 중에 주의 얼굴을 뵈오리니 깰 때에 주의 형상으로 만족하리이다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 22 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시, 인도자를 따라 아얠렛샤할에 맞춘 노래*</font></i></br>
<br>1 내 하나님이여 내 하나님이여 어찌 나를 버리셨나이까 어찌 나를 멀리 하여 돕지 아니하시오며 내 신음 소리를 듣지 아니하시나이까</br>
<br>2 내 하나님이여 내가 낮에도 부르짖고 밤에도 잠잠하지 아니하오나 응답하지 아니하시나이다</br>
<br>3 이스라엘의 찬송 중에 계시는 주여 주는 거룩하시니이다</br>
<br>4 우리 조상들이 주께 의뢰하고 의뢰하였으므로 그들을 건지셨나이다</br>
<br>5 그들이 주께 부르짖어 구원을 얻고 주께 의뢰하여 수치를 당하지 아니하였나이다</br>
<br>6 나는 벌레요 사람이 아니라 사람의 비방거리요 백성의 조롱거리니이다</br>
<br>7 나를 보는 자는 다 나를 비웃으며 입술을 비쭉거리고 머리를 흔들며 말하되</br>
<br>8 그가 여호와께 의탁하니 구원하실 걸, 그를 기뻐하시니 건지실 걸 하나이다</br>
<br>9 오직 주께서 나를 모태에서 나오게 하시고 내 어머니의 젖을 먹을 때에 의지하게 하셨나이다</br>
<br>10 내가 날 때부터 주께 맡긴 바 되었고 모태에서 나올 때부터 주는 나의 하나님이 되셨나이다</br>
<br>11 나를 멀리 하지 마옵소서 환난이 가까우나 도울 자 없나이다</br>
<br>12 많은 황소가 나를 에워싸며 바산의 힘센 소들이 나를 둘러쌌으며</br>
<br>13 내게 그 입을 벌림이 찢으며 부르짖는 사자 같으니이다</br>
<br>14 나는 물 같이 쏟아졌으며 내 모든 뼈는 어그러졌으며 내 마음은 밀랍 같아서 내 속에서 녹았으며</br>
<br>15 내 힘이 말라 질그릇 조각 같고 내 혀가 입천장에 붙었나이다 주께서 또 나를 죽음의 진토 속에 두셨나이다</br>
<br>16 개들이 나를 에워쌌으며 악한 무리가 나를 둘러 내 수족을 찔렀나이다</br>
<br>17 내가 내 모든 뼈를 셀 수 있나이다 그들이 나를 주목하여 보고</br>
<br>18 내 겉옷을 나누며 속옷을 제비 뽑나이다</br>
<br>19 여호와여 멀리 하지 마옵소서 나의 힘이시여 속히 나를 도우소서</br>
<br>20 내 생명을 칼에서 건지시며 내 유일한 것을 개의 세력에서 구하소서</br>
<br>21 나를 사자의 입에서 구하소서 주께서 내게 응답하시고 들소의 뿔에서 구원하셨나이다</br>
<br>22 내가 주의 이름을 형제에게 선포하고 회중 가운데에서 주를 찬송하리이다</br>
<br>23 여호와를 두려워하는 너희여 그를 찬송할지어다 야곱의 모든 자손이여 그에게 영광을 돌릴지어다 너희 이스라엘 모든 자손이여 그를 경외할지어다</br>
<br>24 그는 곤고한 자의 곤고를 멸시하거나 싫어하지 아니하시며 그의 얼굴을 그에게서 숨기지 아니하시고 그가 울부짖을 때에 들으셨도다</br>
<br>25 큰 회중 가운데에서 나의 찬송은 주께로부터 온 것이니 주를 경외하는 자 앞에서 나의 서원을 갚으리이다</br>
<br>26 겸손한 자는 먹고 배부를 것이며 여호와를 찾는 자는 그를 찬송할 것이라 너희 마음은 영원히 살지어다</br>
<br>27 땅의 모든 끝이 여호와를 기억하고 돌아오며 모든 나라의 모든 족속이 주의 앞에 예배하리니</br>
<br>28 나라는 여호와의 것이요 여호와는 모든 나라의 주재심이로다</br>
<br>29 세상의 모든 풍성한 자가 먹고 경배할 것이요 진토 속으로 내려가는 자 곧 자기 영혼을 살리지 못할 자도 다 그 앞에 절하리로다</br>
<br>30 후손이 그를 섬길 것이요 대대에 주를 전할 것이며</br>
<br>31 와서 그의 공의를 태어날 백성에게 전함이여 주께서 이를 행하셨다 할 것이로다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 25 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시*</font></i></br>
<br>1 여호와여 나의 영혼이 주를 우러러보나이다</br>
<br>2 나의 하나님이여 내가 주께 의지하였사오니 나를 부끄럽지 않게 하시고 나의 원수들이 나를 이겨 개가를 부르지 못하게 하소서</br>
<br>3 주를 바라는 자들은 수치를 당하지 아니하려니와 까닭 없이 속이는 자들은 수치를 당하리이다</br>
<br>4 여호와여 주의 도를 내게 보이시고 주의 길을 내게 가르치소서</br>
<br>5 주의 진리로 나를 지도하시고 교훈하소서 주는 내 구원의 하나님이시니 내가 종일 주를 기다리나이다</br>
<br>6 여호와여 주의 긍휼하심과 인자하심이 영원부터 있었사오니 주여 이것들을 기억하옵소서</br>
<br>7 여호와여 내 젊은 시절의 죄와 허물을 기억하지 마시고 주의 인자하심을 따라 주께서 나를 기억하시되 주의 선하심으로 하옵소서</br>
<br>8 여호와는 선하시고 정직하시니 그러므로 그의 도로 죄인들을 교훈하시리로다</br>
<br>9 온유한 자를 정의로 지도하심이여 온유한 자에게 그의 도를 가르치시리로다</br>
<br>10 여호와의 모든 길은 그의 언약과 증거를 지키는 자에게 인자와 진리로다</br>
<br>11 여호와여 나의 죄악이 크오니 주의 이름으로 말미암아 사하소서</br>
<br>12 여호와를 경외하는 자 누구냐 그가 택할 길을 그에게 가르치시리로다</br>
<br>13 그의 영혼은 평안히 살고 그의 자손은 땅을 상속하리로다</br>
<br>14 여호와의 친밀하심이 그를 경외하는 자들에게 있음이여 그의 언약을 그들에게 보이시리로다</br>
<br>15 내 눈이 항상 여호와를 바라봄은 내 발을 그물에서 벗어나게 하실 것임이로다</br>
<br>16 주여 나는 외롭고 괴로우니 내게 돌이키사 나에게 은혜를 베푸소서</br>
<br>17 내 마음의 근심이 많사오니 나를 고난에서 끌어내소서</br>
<br>18 나의 곤고와 환난을 보시고 내 모든 죄를 사하소서</br>
<br>19 내 원수를 보소서 그들의 수가 많고 나를 심히 미워하나이다</br>
<br>20 내 영혼을 지켜 나를 구원하소서 내가 주께 피하오니 수치를 당하지 않게 하소서</br>
<br>21 내가 주를 바라오니 성실과 정직으로 나를 보호하소서</br>
<br>22 하나님이여 이스라엘을 그 모든 환난에서 속량하소서</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 26 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시*</font></i></br>
<br>1 내가 나의 완전함에 행하였사오며 흔들리지 아니하고 여호와를 의지하였사오니 여호와여 나를 판단하소서</br>
<br>2 여호와여 나를 살피시고 시험하사 내 뜻과 내 양심을 단련하소서</br>
<br>3 주의 인자하심이 내 목전에 있나이다 내가 주의 진리 중에 행하여</br>
<br>4 허망한 사람과 같이 앉지 아니하였사오니 간사한 자와 동행하지도 아니하리이다</br>
<br>5 내가 행악자의 집회를 미워하오니 악한 자와 같이 앉지 아니하리이다</br>
<br>6 여호와여 내가 무죄하므로 손을 씻고 주의 제단에 두루 다니며</br>
<br>7 감사의 소리를 들려 주고 주의 기이한 모든 일을 말하리이다</br>
<br>8 여호와여 내가 주께서 계신 집과 주의 영광이 머무는 곳을 사랑하오니</br>
<br>9 내 영혼을 죄인과 함께, 내 생명을 살인자와 함께 거두지 마소서</br>
<br>10 그들의 손에 사악함이 있고 그들의 오른손에 뇌물이 가득하오나</br>
<br>11 나는 나의 완전함에 행하오리니 나를 속량하시고 내게 은혜를 베푸소서</br>
<br>12 내 발이 평탄한 데에 섰사오니 무리 가운데에서 여호와를 송축하리이다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 27 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시*</font></i></br>
<br>1 여호와는 나의 빛이요 나의 구원이시니 내가 누구를 두려워하리요 여호와는 내 생명의 능력이시니 내가 누구를 무서워하리요</br>
<br>2 악인들이 내 살을 먹으려고 내게로 왔으나 나의 대적들, 나의 원수들인 그들은 실족하여 넘어졌도다</br>
<br>3 군대가 나를 대적하여 진 칠지라도 내 마음이 두렵지 아니하며 전쟁이 일어나 나를 치려 할지라도 나는 여전히 태연하리로다</br>
<br>4 내가 여호와께 바라는 한 가지 일 그것을 구하리니 곧 내가 내 평생에 여호와의 집에 살면서 여호와의 아름다움을 바라보며 그의 성전에서 사모하는 그것이라</br>
<br>5 여호와께서 환난 날에 나를 그의 초막 속에 비밀히 지키시고 그의 장막 은밀한 곳에 나를 숨기시며 높은 바위 위에 두시리로다</br>
<br>6 이제 내 머리가 나를 둘러싼 내 원수 위에 들리리니 내가 그의 장막에서 즐거운 제사를 드리겠고 노래하며 여호와를 찬송하리로다</br>
<br>7 여호와여 내가 소리 내어 부르짖을 때에 들으시고 또한 나를 긍휼히 여기사 응답하소서</br>
<br>8 너희는 내 얼굴을 찾으라 하실 때에 내가 마음으로 주께 말하되 여호와여 내가 주의 얼굴을 찾으리이다 하였나이다</br>
<br>9 주의 얼굴을 내게서 숨기지 마시고 주의 종을 노하여 버리지 마소서 주는 나의 도움이 되셨나이다 나의 구원의 하나님이시여 나를 버리지 마시고 떠나지 마소서</br>
<br>10 내 부모는 나를 버렸으나 여호와는 나를 영접하시리이다</br>
<br>11 여호와여 주의 도를 내게 가르치시고 내 원수를 생각하셔서 평탄한 길로 나를 인도하소서</br>
<br>12 내 생명을 내 대적에게 맡기지 마소서 위증자와 악을 토하는 자가 일어나 나를 치려 함이니이다</br>
<br>13 내가 산 자들의 땅에서 여호와의 선하심을 보게 될 줄 확실히 믿었도다</br>
<br>14 너는 여호와를 기다릴지어다 강하고 담대하며 여호와를 기다릴지어다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 28 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시*</font></i></br>
<br>1 여호와여 내가 주께 부르짖으오니 나의 반석이여 내게 귀를 막지 마소서 주께서 내게 잠잠하시면 내가 무덤에 내려가는 자와 같을까 하나이다</br>
<br>2 내가 주의 지성소를 향하여 나의 손을 들고 주께 부르짖을 때에 나의 간구하는 소리를 들으소서</br>
<br>3 악인과 악을 행하는 자들과 함께 나를 끌어내지 마옵소서 그들은 그 이웃에게 화평을 말하나 그들의 마음에는 악독이 있나이다</br>
<br>4 그들이 하는 일과 그들의 행위가 악한 대로 갚으시며 그들의 손이 지은 대로 그들에게 갚아 그 마땅히 받을 것으로 그들에게 갚으소서</br>
<br>5 그들은 여호와께서 행하신 일과 손으로 지으신 것을 생각하지 아니하므로 여호와께서 그들을 파괴하고 건설하지 아니하시리로다</br>
<br>6 여호와를 찬송함이여 내 간구하는 소리를 들으심이로다</br>
<br>7 여호와는 나의 힘과 나의 방패이시니 내 마음이 그를 의지하여 도움을 얻었도다 그러므로 내 마음이 크게 기뻐하며 내 노래로 그를 찬송하리로다</br>
<br>8 여호와는 그들의 힘이시요 그의 기름 부음 받은 자의 구원의 요새이시로다</br>
<br>9 주의 백성을 구원하시며 주의 산업에 복을 주시고 또 그들의 목자가 되시어 영원토록 그들을 인도하소서</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 31 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시, 인도자를 따라 부르는 노래*</font></i></br>
<br>1 여호와여 내가 주께 피하오니 나를 영원히 부끄럽게 하지 마시고 주의 공의로 나를 건지소서</br>
<br>2 내게 귀를 기울여 속히 건지시고 내게 견고한 바위와 구원하는 산성이 되소서</br>
<br>3 주는 나의 반석과 산성이시니 그러므로 주의 이름을 생각하셔서 나를 인도하시고 지도하소서</br>
<br>4 그들이 나를 위하여 비밀히 친 그물에서 빼내소서 주는 나의 산성이시니이다</br>
<br>5 내가 나의 영을 주의 손에 부탁하나이다 진리의 하나님 여호와여 나를 속량하셨나이다</br>
<br>6 내가 허탄한 거짓을 숭상하는 자들을 미워하고 여호와를 의지하나이다</br>
<br>7 내가 주의 인자하심을 기뻐하며 즐거워할 것은 주께서 나의 고난을 보시고 환난 중에 있는 내 영혼을 아셨으며</br>
<br>8 나를 원수의 수중에 가두지 아니하셨고 내 발을 넓은 곳에 세우셨음이니이다</br>
<br>9 여호와여 내가 고통 중에 있사오니 내게 은혜를 베푸소서 내가 근심 때문에 눈과 영혼과 몸이 쇠하였나이다</br>
<br>10 내 일생을 슬픔으로 보내며 나의 연수를 탄식으로 보냄이여 내 기력이 나의 죄악 때문에 약하여지며 나의 뼈가 쇠하도소이다</br>
<br>11 내가 모든 대적들 때문에 욕을 당하고 내 이웃에게서는 심히 당하니 내 친구가 놀라고 길에서 보는 자가 나를 피하였나이다</br>
<br>12 내가 잊어버린 바 됨이 죽은 자를 마음에 두지 아니함 같고 깨진 그릇과 같으니이다</br>
<br>13 내가 무리의 비방을 들었으므로 사방이 두려움으로 감싸였나이다 그들이 나를 치려고 함께 의논할 때에 내 생명을 빼앗기로 꾀하였나이다</br>
<br>14 여호와여 그러하여도 나는 주께 의지하고 말하기를 주는 내 하나님이시라 하였나이다</br>
<br>15 나의 앞날이 주의 손에 있사오니 내 원수들과 나를 핍박하는 자들의 손에서 나를 건져 주소서</br>
<br>16 주의 얼굴을 주의 종에게 비추시고 주의 사랑하심으로 나를 구원하소서</br>
<br>17 여호와여 내가 주를 불렀사오니 나를 부끄럽게 하지 마시고 악인들을 부끄럽게 하사 스올에서 잠잠하게 하소서</br>
<br>18 교만하고 완악한 말로 무례히 의인을 치는 거짓 입술이 말 못하는 자 되게 하소서</br>
<br>19 주를 두려워하는 자를 위하여 쌓아 두신 은혜 곧 주께 피하는 자를 위하여 인생 앞에 베푸신 은혜가 어찌 그리 큰지요</br>
<br>20 주께서 그들을 주의 은밀한 곳에 숨기사 사람의 꾀에서 벗어나게 하시고 비밀히 장막에 감추사 말 다툼에서 면하게 하시리이다</br>
<br>21 여호와를 찬송할지어다 견고한 성에서 그의 놀라운 사랑을 내게 보이셨음이로다</br>
<br>22 내가 놀라서 말하기를 주의 목전에서 끊어졌다 하였사오나 내가 주께 부르짖을 때에 주께서 나의 간구하는 소리를 들으셨나이다</br>
<br>23 너희 모든 성도들아 여호와를 사랑하라 여호와께서 진실한 자를 보호하시고 교만하게 행하는 자에게 엄중히 갚으시느니라</br>
<br>24 여호와를 바라는 너희들아 강하고 담대하라</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 35 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시*</font></i></br>
<br>1 여호와여 나와 다투는 자와 다투시고 나와 싸우는 자와 싸우소서</br>
<br>2 방패와 손 방패를 잡으시고 일어나 나를 도우소서</br>
<br>3 창을 빼사 나를 쫓는 자의 길을 막으시고 또 내 영혼에게 나는 네 구원이라 이르소서</br>
<br>4 내 생명을 찾는 자들이 부끄러워 수치를 당하게 하시며 나를 상해하려 하는 자들이 물러가 낭패를 당하게 하소서</br>
<br>5 그들을 바람 앞에 겨와 같게 하시고 여호와의 천사가 그들을 몰아내게 하소서</br>
<br>6 그들의 길을 어둡고 미끄럽게 하시며 여호와의 천사가 그들을 뒤쫓게 하소서</br>
<br>7 그들이 까닭 없이 나를 잡으려고 그들의 그물을 웅덩이에 숨기며 까닭 없이 내 생명을 해하려고 함정을 팠사오니</br>
<br>8 멸망이 순식간에 그에게 닥치게 하시며 그가 숨긴 그물에 자기가 잡히게 하시며 멸망 중에 떨어지게 하소서</br>
<br>9 내 영혼이 여호와를 즐거워함이여 그의 구원을 기뻐하리로다</br>
<br>10 내 모든 뼈가 이르기를 여호와와 같은 이가 누구냐 그는 가난한 자를 그보다 강한 자에게서 건지시고 가난하고 궁핍한 자를 노략하는 자에게서 건지시는 이라 하리로다</br>
<br>11 불의한 증인들이 일어나서 내가 알지 못하는 일로 내게 질문하며</br>
<br>12 내게 선을 악으로 갚아 나의 영혼을 외롭게 하나</br>
<br>13 나는 그들이 병 들었을 때에 굵은 베 옷을 입으며 금식하여 내 영혼을 괴롭게 하였더니 내 기도가 내 품으로 돌아왔도다</br>
<br>14 내가 나의 친구와 형제에게 행함 같이 그들에게 행하였으며 내가 몸을 굽히고 슬퍼하기를 어머니를 곡함 같이 하였도다</br>
<br>15 그러나 내가 넘어지매 그들이 기뻐하여 서로 모임이여 불량배가 내가 알지 못하는 중에 모여서 나를 치며 찢기를 마지아니하도다</br>
<br>16 그들은 연회에서 망령되이 조롱하는 자 같이 나를 향하여 그들의 이를 갈도다</br>
<br>17 주여 어느 때까지 관망하시려 하나이까 내 영혼을 저 멸망자에게서 구원하시며 내 유일한 것을 사자들에게서 건지소서</br>
<br>18 내가 대회 중에서 주께 감사하며 많은 백성 중에서 주를 찬송하리이다</br>
<br>19 부당하게 나의 원수된 자가 나로 말미암아 기뻐하지 못하게 하시며 까닭 없이 나를 미워하는 자들이 서로 눈짓하지 못하게 하소서</br>
<br>20 무릇 그들은 화평을 말하지 아니하고 오히려 평안히 땅에 사는 자들을 거짓말로 모략하며</br>
<br>21 또 그들이 나를 향하여 입을 크게 벌리고 하하 우리가 목격하였다 하나이다</br>
<br>22 여호와여 주께서 이를 보셨사오니 잠잠하지 마옵소서 주여 나를 멀리하지 마옵소서</br>
<br>23 나의 하나님, 나의 주여 떨치고 깨셔서 나를 공판하시며 나의 송사를 다스리소서</br>
<br>24 여호와 나의 하나님이여 주의 공의대로 나를 판단하사 그들이 나로 말미암아 기뻐하지 못하게 하소서</br>
<br>25 그들이 마음속으로 이르기를 아하 소원을 성취하였다 하지 못하게 하시며 우리가 그를 삼켰다 말하지 못하게 하소서</br>
<br>26 나의 재난을 기뻐하는 자들이 함께 부끄러워 낭패를 당하게 하시며 나를 향하여 스스로 뽐내는 자들이 수치와 욕을 당하게 하소서</br>
<br>27 나의 의를 즐거워하는 자들이 기꺼이 노래 부르고 즐거워하게 하시며 그의 종의 평안함을 기뻐하시는 여호와는 위대하시다 하는 말을 그들이 항상 말하게 하소서</br>
<br>28 나의 혀가 주의 의를 말하며 종일토록 주를 찬송하리이다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 36 편</font></br></strong>
<br><i><font color="#808080">*여호와의 종 다윗의 시, 인도자를 따라 부르는 노래*</font></i></br>
<br>1 악인의 죄가 그의 마음속으로 이르기를 그의 눈에는 하나님을 두려워하는 빛이 없다 하니</br>
<br>2 그가 스스로 자랑하기를 자기의 죄악은 드러나지 아니하고 미워함을 받지도 아니하리라 함이로다</br>
<br>3 그의 입에서 나오는 말은 죄악과 속임이라 그는 지혜와 선행을 그쳤도다</br>
<br>4 그는 그의 침상에서 죄악을 꾀하며 스스로 악한 길에 서고 악을 거절하지 아니하는도다</br>
<br>5 여호와여 주의 인자하심이 하늘에 있고 주의 진실하심이 공중에 사무쳤으며</br>
<br>6 주의 의는 하나님의 산들과 같고 주의 심판은 큰 바다와 같으니이다 여호와여 주는 사람과 짐승을 구하여 주시나이다</br>
<br>7 하나님이여 주의 인자하심이 어찌 그리 보배로우신지요 사람들이 주의 날개 그늘 아래에 피하나이다</br>
<br>8 그들이 주의 집에 있는 살진 것으로 풍족할 것이라 주께서 주의 복락의 강물을 마시게 하시리이다</br>
<br>9 진실로 생명의 원천이 주께 있사오니 주의 빛 안에서 우리가 빛을 보리이다</br>
<br>10 주를 아는 자들에게 주의 인자하심을 계속 베푸시며 마음이 정직한 자에게 주의 공의를 베푸소서</br>
<br>11 교만한 자의 발이 내게 이르지 못하게 하시며 악인들의 손이 나를 쫓아내지 못하게 하소서</br>
<br>12 악을 행하는 자들이 거기서 넘어졌으니 엎드러지고 다시 일어날 수 없으리이다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 38 편</font></br></strong>
<br><i><font color="#808080">*다윗의 기념하는 시*</font></i></br>
<br>1 여호와여 주의 노하심으로 나를 책망하지 마시고 주의 분노하심으로 나를 징계하지 마소서</br>
<br>2 주의 화살이 나를 찌르고 주의 손이 나를 심히 누르시나이다</br>
<br>3 주의 진노로 말미암아 내 살에 성한 곳이 없사오며 나의 죄로 말미암아 내 뼈에 평안함이 없나이다</br>
<br>4 내 죄악이 내 머리에 넘쳐서 무거운 짐 같으니 내가 감당할 수 없나이다</br>
<br>5 내 상처가 썩어 악취가 나오니 내가 우매한 까닭이로소이다</br>
<br>6 내가 아프고 심히 구부러졌으며 종일토록 슬픔 중에 다니나이다</br>
<br>7 내 허리에 열기가 가득하고 내 살에 성한 곳이 없나이다</br>
<br>8 내가 피곤하고 심히 상하였으매 마음이 불안하여 신음하나이다</br>
<br>9 주여 나의 모든 소원이 주 앞에 있사오며 나의 탄식이 주 앞에 감추이지 아니하나이다</br>
<br>10 내 심장이 뛰고 내 기력이 쇠하여 내 눈의 빛도 나를 떠났나이다</br>
<br>11 내가 사랑하는 자와 내 친구들이 내 상처를 멀리하고 내 친척들도 멀리 섰나이다</br>
<br>12 내 생명을 찾는 자가 올무를 놓고 나를 해하려는 자가 괴악한 일을 말하여 종일토록 음모를 꾸미오나</br>
<br>13 나는 못 듣는 자 같이 듣지 아니하고 말 못하는 자 같이 입을 열지 아니하오니</br>
<br>14 나는 듣지 못하는 자 같아서 내 입에는 반박할 말이 없나이다</br>
<br>15 여호와여 내가 주를 바랐사오니 내 주 하나님이 내게 응답하시리이다</br>
<br>16 내가 말하기를 두렵건대 그들이 나 때문에 기뻐하며 내가 실족할 때에 나를 향하여 스스로 교만할까 하였나이다</br>
<br>17 내가 넘어지게 되었고 나의 근심이 항상 내 앞에 있사오니</br>
<br>18 내 죄악을 아뢰고 내 죄를 슬퍼함이니이다</br>
<br>19 내 원수가 활발하며 강하고 부당하게 나를 미워하는 자가 많으며</br>
<br>20 또 악으로 선을 대신하는 자들이 내가 선을 따른다는 것 때문에 나를 대적하나이다</br>
<br>21 여호와여 나를 버리지 마소서 나의 하나님이여 나를 멀리하지 마소서</br>
<br>22 속히 나를 도우소서 주 나의 구원이시여</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 40 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시, 인도자를 따라 부르는 노래*</font></i></br>
<br>1 내가 여호와를 기다리고 기다렸더니 귀를 기울이사 나의 부르짖음을 들으셨도다</br>
<br>2 나를 기가 막힐 웅덩이와 수렁에서 끌어올리시고 내 발을 반석 위에 두사 내 걸음을 견고하게 하셨도다</br>
<br>3 새 노래 곧 우리 하나님께 올릴 찬송을 내 입에 두셨으니 많은 사람이 보고 두려워하여 여호와를 의지하리로다</br>
<br>4 여호와를 의지하고 교만한 자와 거짓에 치우치는 자를 돌아보지 아니하는 자는 복이 있도다</br>
<br>5 여호와 나의 하나님이여 주께서 행하신 기적이 많고 우리를 향하신 주의 생각도 많아 누구도 주와 견줄 수가 없나이다 내가 널리 알려 말하고자 하나 너무 많아 그 수를 셀 수도 없나이다</br>
<br>6 주께서 내 귀를 통하여 내게 들려 주시기를 제사와 예물을 기뻐하지 아니하시며 번제와 속죄제를 요구하지 아니하신다 하신지라</br>
<br>7 그 때에 내가 말하기를 내가 왔나이다 나를 가리켜 기록한 것이 두루마리 책에 있나이다</br>
<br>8 나의 하나님이여 내가 주의 뜻 행하기를 즐기오니 주의 법이 나의 심중에 있나이다 하였나이다</br>
<br>9 내가 많은 회중 가운데에서 의의 기쁜 소식을 전하였나이다 여호와여 내가 내 입술을 닫지 아니할 줄을 주께서 아시나이다</br>
<br>10 내가 주의 공의를 내 심중에 숨기지 아니하고 주의 성실과 구원을 선포하였으며 내가 주의 인자와 진리를 많은 회중 가운데에서 감추지 아니하였나이다</br>
<br>11 여호와여 주의 긍휼을 내게서 거두지 마시고 주의 인자와 진리로 나를 항상 보호하소서</br>
<br>12 수많은 재앙이 나를 둘러싸고 나의 죄악이 나를 덮치므로 우러러볼 수도 없으며 죄가 나의 머리털보다 많으므로 내가 낙심하였음이니이다</br>
<br>13 여호와여 은총을 베푸사 나를 구원하소서 여호와여 속히 나를 도우소서</br>
<br>14 내 생명을 찾아 멸하려 하는 자는 다 수치와 낭패를 당하게 하시며 나의 해를 기뻐하는 자는 다 물러가 욕을 당하게 하소서</br>
<br>15 나를 향하여 하하 하하 하며 조소하는 자들이 자기 수치로 말미암아 놀라게 하소서</br>
<br>16 주를 찾는 자는 다 주 안에서 즐거워하고 기뻐하게 하시며 주의 구원을 사랑하는 자는 항상 말하기를 여호와는 위대하시다 하게 하소서</br>
<br>17 나는 가난하고 궁핍하오나 주께서는 나를 생각하시오니 주는 나의 도움이시요 나를 건지시는 이시라 나의 하나님이여 지체하지 마소서</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 41 편</font></br></strong>
<br><i><font color="#808080">*다윗의 시, 인도자를 따라 부르는 노래*</font></i></br>
<br>1 가난한 자를 보살피는 자에게 복이 있음이여 재앙의 날에 여호와께서 그를 건지시리로다</br>
<br>2 여호와께서 그를 지키사 살게 하시리니 그가 이 세상에서 복을 받을 것이라 주여 그를 그 원수들의 뜻에 맡기지 마소서</br>
<br>3 여호와께서 그를 병상에서 붙드시고 그가 누워 있을 때마다 그의 병을 고쳐 주시나이다</br>
<br>4 내가 말하기를 여호와여 내게 은혜를 베푸소서 내가 주께 범죄하였사오니 나를 고치소서 하였나이다</br>
<br>5 나의 원수가 내게 대하여 악담하기를 그가 어느 때에나 죽고 그의 이름이 언제나 없어질까 하며</br>
<br>6 나를 보러 와서는 거짓을 말하고 그의 중심에 악을 쌓았다가 나가서는 이를 널리 선포하오며</br>
<br>7 나를 미워하는 자가 다 하나같이 내게 대하여 수군거리고 나를 해하려고 꾀하며</br>
<br>8 이르기를 악한 병이 그에게 들었으니 이제 그가 눕고 다시 일어나지 못하리라 하오며</br>
<br>9 내가 신뢰하여 내 떡을 나눠 먹던 나의 가까운 친구도 나를 대적하여 그의 발꿈치를 들었나이다</br>
<br>10 그러하오나 주 여호와여 내게 은혜를 베푸시고 나를 일으키사 내가 그들에게 보응하게 하소서 이로써</br>
<br>11 내 원수가 나를 이기지 못하오니 주께서 나를 기뻐하시는 줄을 내가 알았나이다</br>
<br>12 주께서 나를 온전한 중에 붙드시고 영원히 주 앞에 세우시나이다</br>
<br>13 이스라엘의 하나님 여호와를 영원부터 영원까지 송축할지로다 아멘 아멘</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 53 편</font></br></strong>
<br><i><font color="#808080">*다윗의 마스길, 인도자를 따라 마할랏에 맞춘 노래*</font></i></br>
<br>1 어리석은 자는 그의 마음에 이르기를 하나님이 없다 하도다 그들은 부패하며 가증한 악을 행함이여 선을 행하는 자가 없도다</br>
<br>2 하나님이 하늘에서 인생을 굽어살피사 지각이 있는 자와 하나님을 찾는 자가 있는가 보려 하신즉</br>
<br>3 각기 물러가 함께 더러운 자가 되고 선을 행하는 자 없으니 한 사람도 없도다</br>
<br>4 죄악을 행하는 자들은 무지하냐 그들이 떡 먹듯이 내 백성을 먹으면서 하나님을 부르지 아니하는도다</br>
<br>5 그들이 두려움이 없는 곳에서 크게 두려워하였으니 너를 대항하여 진 친 그들의 뼈를 하나님이 흩으심이라 하나님이 그들을 버리셨으므로 네가 그들에게 수치를 당하게 하였도다</br>
<br>6 시온에서 이스라엘을 구원하여 줄 자 누구인가 하나님이 자기 백성의 포로된 것을 돌이키실 때에 야곱이 즐거워하며 이스라엘이 기뻐하리로다</br>
<br>&nbsp;</br>
<strong><br><font color="#4682b4">시편 55 편</font></br></strong>
<br><i><font color="#808080">*다윗의 마스길, 인도자를 따라 현악에 맞춘 노래*</font></i></br>
<br>1 하나님이여 내 기도에 귀를 기울이시고 내가 간구할 때에 숨지 마소서</br>
<br>2 내게 굽히사 응답하소서 내가 근심으로 편하지 못하여 탄식하오니</br>
<br>3 이는 원수의 소리와 악인의 압제 때문이라 그들이 죄악을 내게 더하며 노하여 나를 핍박하나이다</br>
<br>4 내 마음이 내 속에서 심히 아파하며 사망의 위험이 내게 이르렀도다</br>
<br>5 두려움과 떨림이 내게 이르고 공포가 나를 덮었도다</br>
<br>6 나는 말하기를 만일 내게 비둘기 같이 날개가 있다면 날아가서 편히 쉬리로다</br>
<br>7 내가 멀리 날아가서 광야에 머무르리로다 (셀라)</br>
<br>8 내가 나의 피난처로 속히 가서 폭풍과 광풍을 피하리라 하였도다</br>
<br>9 내가 성내에서 강포와 분쟁을 보았사오니 주여 그들을 멸하소서 그들의 혀를 잘라 버리소서</br>
<br>10 그들이 주야로 성벽 위에 두루 다니니 성 중에는 죄악과 재난이 있으며</br>
<br>11 악독이 그 중에 있고 압박과 속임수가 그 거리를 떠나지 아니하도다</br>
<br>12 나를 책망하는 자는 원수가 아니라 원수일진대 내가 참았으리라 나를 대하여 자기를 높이는 자는 나를 미워하는 자가 아니라 미워하는 자일진대 내가 그를 피하여 숨었으리라</br>
<br>13 그는 곧 너로다 나의 동료, 나의 친구요 나의 가까운 친우로다</br>
<br>14 우리가 같이 재미있게 의논하며 무리와 함께 하여 하나님의 집 안에서 다녔도다</br>
<br>15 사망이 갑자기 그들에게 임하여 산 채로 스올에 내려갈지어다 이는 악독이 그들의 거처에 있고 그들 가운데에 있음이로다</br>
<br>16 나는 하나님께 부르짖으리니 여호와께서 나를 구원하시리로다</br>
<br>17 저녁과 아침과 정오에 내가 근심하여 탄식하리니 여호와께서 내 소리를 들으시리로다</br>
<br>18 나를 대적하는 자 많더니 나를 치는 전쟁에서 그가 내 생명을 구원하사 평안하게 하셨도다</br>
<br>19 옛부터 계시는 하나님이 들으시고 그들을 낮추시리이다 (셀라) 그들은 변하지 아니하며 하나님을 경외하지 아니함이니이다</br>
<br>20 그는 손을 들어 자기와 화목한 자를 치고 그의 언약을 배반하였도다</br>
<br>21 그의 입은 우유 기름보다 미끄러우나 그의 마음은 전쟁이요 그의 말은 기름보다 유하나 실상은 뽑힌 칼이로다</br>
<br>22 네 짐을 여호와께 맡기라 그가 너를 붙드시고 의인의 요동함을 영원히 허락하지 아니하시리로다</br>
<br>23 하나님이여 주께서 그들로 파멸의 웅덩이에 빠지게 하시리이다 피를 흘리게 하며 속이는 자들은 그들의 날의 반도 살지 못할 것이나 나는 주를 의지하리이다</br>
<br>&nbsp;</br>
<br>    26 일차 끝</br>
<br>&nbsp;</br>
    </h2>
  </div>

  <!-- 모달 (설명/요약 출력) -->
  <div id="explanation-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
      <span class="close-button" id="close-modal" aria-label="닫기">&times;</span>
      <h3 id="modal-title">구절 설명</h3>
      <img id="modal-image" src="" alt="설명 관련 이미지" />
      <div id="modal-text">구절을 드래그하여 선택하고 '구절설명' 버튼을 누르세요.</div>
    </div>
  </div>

  <div id="scroll-marker-container" class="scroll-marker-container" aria-hidden="true"></div>

  <script>
    // ------------------------------
    // API KEY (사용자 입력 상태)
    const apiKey = "AIzaSyDUlSQlSPgnrFBXpnUJMDoUO3s_KsaoFRU";
    // ------------------------------

    // DOM
    const bibleTextEl = document.getElementById('bible-text');
    const searchCountEl = document.getElementById('search-count');
    const nextLocationBtn = document.getElementById('next-location-btn');
    const scrollMarkerContainer = document.getElementById('scroll-marker-container');

    const explanationIconButton = document.getElementById('explanation-icon-button');
    const explanationButtonWrapper = document.getElementById('explanation-button-wrapper');
    const explanationSubButtons = document.getElementById('explanation-sub-buttons');
    const detailedExplanationButton = document.getElementById('detailed-explanation-button');
    const simpleExplanationButton = document.getElementById('simple-explanation-button');

    const summarySimpleMain = document.getElementById('summary-simple-main');
    const summaryDetailedMain = document.getElementById('summary-detailed-main');

    const modal = document.getElementById('explanation-modal');
    const closeModalButton = document.getElementById('close-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalImage = document.getElementById('modal-image');
    const modalText = document.getElementById('modal-text');

    const audio = document.getElementById('audio-file');
    const playBtn = document.getElementById('play-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const stopBtn = document.getElementById('stop-btn');
    const progressBar = document.getElementById('progress-bar');
    const rewindBtn = document.getElementById('rewind-10');
    const forwardBtn = document.getElementById('forward-10');
    const speedDisplay = document.getElementById('speed-display');
    const speedDown02Btn = document.getElementById('speed-down-02');
    const speedDown01Btn = document.getElementById('speed-down-01');
    const speedUp01Btn = document.getElementById('speed-up-01');
    const speedUp02Btn = document.getElementById('speed-up-02');
    const speedResetBtn = document.getElementById('speed-reset');
    const volumeSlider = document.getElementById('volume-slider');
    const muteBtn = document.getElementById('mute-btn');
    const currentTimeEl = document.getElementById('current-time');
    const remainingTimeEl = document.getElementById('remaining-time');

    const upBtn = document.getElementById('up');
    const downBtn = document.getElementById('down');
    const fontSizeEl = document.getElementById('font-size');

    // 상태
    let originalText = "";
    let selectedVerse = "";
    let selectionRange = null; // 선택 영역 복원용
    let foundSentences = [];
    let currentSearchIndex = -1;
    let currentSpeed = 1.0;
    let isMuted = false;
    let selectionDebounce = null;

    // 유틸
    function escapeRegExp(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
    function formatTime(sec) { if (!isFinite(sec) || sec < 0) return '0:00'; const m = Math.floor(sec/60); const s = Math.floor(sec%60); return `${m}:${String(s).padStart(2,'0')}`; }

    // 초기화
    window.addEventListener('DOMContentLoaded', () => {
      originalText = bibleTextEl.innerHTML; // 원본 보관
      updateFontSizeDisplay();
      updateSpeed();

      // ---------------------------
  // (추가 1) 본문 줄 단위 분리
  // ---------------------------
  const lines = originalText.split(/<br\s*\/?>/i);
  bibleTextEl.innerHTML = lines.map(line => {
    if (line.trim() === "") return "<br>";
    return `<span class="line">${line}</span><br>`;
  }).join("");

  const lineElements = document.querySelectorAll("#bible-text .line");

  // ---------------------------
  // (추가 2) 스크롤 시 중앙 두 줄 강조
  // ---------------------------
  function highlightCenterLines() {
    const viewportCenter = window.innerHeight / 2 + window.scrollY;
    let closestIndex = -1;
    let minDistance = Infinity;

    lineElements.forEach((line, i) => {
      const rect = line.getBoundingClientRect();
      const lineCenter = rect.top + window.scrollY + rect.height / 2;
      const distance = Math.abs(lineCenter - viewportCenter);

      if (distance < minDistance) {
        minDistance = distance;
        closestIndex = i;
      }
    });

    // 강조 초기화
    lineElements.forEach(line => line.classList.remove("highlight"));

    // 중앙 두 줄 강조
    if (closestIndex >= 0) {
      lineElements[closestIndex].classList.add("highlight");
      if (closestIndex + 1 < lineElements.length) {
        lineElements[closestIndex + 1].classList.add("highlight");
      }
    }
  }

  // 스크롤 이벤트 등록
  window.addEventListener("scroll", highlightCenterLines);
  // 초기 실행
  highlightCenterLines();
// ---------------------------
    // (추가 3) PC에서 2줄씩 부드럽게 스크롤
    // ---------------------------
   window.addEventListener("wheel", function(e) {
  if (e.ctrlKey) return;

  // ✅ 모달이 열려 있고, 이벤트가 모달 위에서 발생하면
  //    전역 스크롤 커스텀을 "중단"해서 기본(모달 내부) 스크롤이 동작하도록 둡니다.
  const modal = document.getElementById('explanation-modal');
  if (modal && modal.style.display === 'block' && modal.contains(e.target)) {
    return; // preventDefault 하지 않음 → 모달이 스스로 스크롤
  }

  const firstLine = document.querySelector("#bible-text .line");
  if (!firstLine) return;

  const lineHeight = firstLine.getBoundingClientRect().height;

  e.preventDefault();
  window.scrollBy({
    top: e.deltaY > 0 ? lineHeight * 2 : -lineHeight * 2,
    behavior: "smooth"
  });
}, { passive: false });
// ---------------------------

      // 폰트 버튼
      upBtn.addEventListener('click', () => {
        const current = parseFloat(getComputedStyle(bibleTextEl).fontSize);
        if (current + 4 <= 80) { bibleTextEl.style.fontSize = (current + 4) + 'px'; updateFontSizeDisplay(); }
      });
      downBtn.addEventListener('click', () => {
        const current = parseFloat(getComputedStyle(bibleTextEl).fontSize);
        if (current - 4 >= 12) { bibleTextEl.style.fontSize = (current - 4) + 'px'; updateFontSizeDisplay(); }
      });

      // 검색 폼
      const searchForm = document.forms.f1;
      searchForm.addEventListener('submit', (e) => { e.preventDefault(); findString(searchForm.t1.value); });
      searchForm.b2.addEventListener('click', () => { clearHighlight(); });

      // nextLocation
      nextLocationBtn.addEventListener('click', nextLocation);

      // 오디오
      playBtn.addEventListener('click', () => { audio.play().catch(()=>{}); });
      pauseBtn.addEventListener('click', () => audio.pause());
      stopBtn.addEventListener('click', () => { audio.pause(); audio.currentTime = 0; });

      speedDown02Btn.addEventListener('click', () => { currentSpeed = Math.max(0.5, currentSpeed - 0.2); updateSpeed(); });
      speedDown01Btn.addEventListener('click', () => { currentSpeed = Math.max(0.5, currentSpeed - 0.1); updateSpeed(); });
      speedUp01Btn.addEventListener('click', () => { currentSpeed = Math.min(2.0, currentSpeed + 0.1); updateSpeed(); });
      speedUp02Btn.addEventListener('click', () => { currentSpeed = Math.min(2.0, currentSpeed + 0.2); updateSpeed(); });
      speedResetBtn.addEventListener('click', () => { currentSpeed = 1.0; updateSpeed(); });

      volumeSlider.addEventListener('input', () => { audio.volume = Number(volumeSlider.value); });
      muteBtn.addEventListener('click', () => { isMuted = !isMuted; audio.muted = isMuted; muteBtn.textContent = isMuted ? '🔇' : '🔊'; });

      // progress bar updates
      audio.addEventListener('timeupdate', () => {
        if (!isFinite(audio.duration) || audio.duration <= 0) return;
        const pct = (audio.currentTime / audio.duration) * 100;
        progressBar.value = pct;
        currentTimeEl.textContent = formatTime(audio.currentTime);
        remainingTimeEl.textContent = '-' + formatTime(audio.duration - audio.currentTime);
      }, { passive: true });

      audio.addEventListener('loadedmetadata', () => {
        currentTimeEl.textContent = '0:00';
        remainingTimeEl.textContent = '-' + formatTime(audio.duration || 0);
      });

      progressBar.addEventListener('input', () => {
        if (!isFinite(audio.duration) || audio.duration <= 0) return;
        const pct = progressBar.value / 100;
        audio.currentTime = audio.duration * pct;
      }, { passive: true });

      rewindBtn.addEventListener('click', () => {
        audio.currentTime = Math.max(0, audio.currentTime - 10);
      });

      forwardBtn.addEventListener('click', () => {
        if (isFinite(audio.duration)) {
          audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
        }
      });

      // 설명 버튼(책) - 클릭시 서브버튼 토글
      // iOS에서 선택이 사라지는 문제를 피하기 위해 클릭/터치 이전 선택영역을 저장하고, 토글 후 복원
      explanationIconButton.addEventListener('pointerdown', (ev) => {
        // pointerdown에서 기본 동작을 방지하면 iOS가 선택을 잃지 않는 경우가 있지만, 안전하게 클론을 저장
        const sel = window.getSelection();
        try {
          if (sel && sel.rangeCount > 0) selectionRange = sel.getRangeAt(0).cloneRange();
        } catch(e) {
          selectionRange = null;
        }
      }, { passive: true });

      explanationIconButton.addEventListener('click', (ev) => {
        ev.stopPropagation();
        // 토글하기 전에 현재 선택을 저장(안전)
        const sel = window.getSelection();
        try { if (sel && sel.rangeCount > 0) selectionRange = sel.getRangeAt(0).cloneRange(); } catch(e){ selectionRange = null; }
        explanationButtonWrapper.classList.toggle('active');

        // 토글 후 약간 뒤에 선택 복원 (iOS에서 클릭으로 인해 사라졌다면 복원)
        setTimeout(() => {
          if (selectionRange) {
            const sel2 = window.getSelection();
            sel2.removeAllRanges();
            try { sel2.addRange(selectionRange); } catch(e){ /* ignore */ }
            // update selectedVerse accordingly
            updateSelectedVerseFromRange(selectionRange);
          }
        }, 60);
      });

      // 책 버튼 외부 클릭으로 닫기
      document.body.addEventListener('click', (ev) => {
        if (!explanationButtonWrapper.contains(ev.target)) explanationButtonWrapper.classList.remove('active');
      });

      // 상세/간단 구절설명 버튼 - 클릭시 선택문구 사용
      detailedExplanationButton.addEventListener('click', () => {
        const v = (selectedVerse || '').trim();
        if (!v) { showModal("구절을 먼저 선택하세요","본문에서 구절이나 단어를 드래그하여 선택한 후 다시 버튼을 눌러주세요."); }
        else { fetchExplanation(v, 'detailed'); }
        explanationButtonWrapper.classList.remove('active');
      });
      simpleExplanationButton.addEventListener('click', () => {
        const v = (selectedVerse || '').trim();
        if (!v) { showModal("구절을 먼저 선택하세요","본문에서 구절이나 단어를 드래그하여 선택한 후 다시 버튼을 눌러주세요."); }
        else { fetchExplanation(v, 'simple'); }
        explanationButtonWrapper.classList.remove('active');
      });

      // 본문 요약 버튼 (항상 보이는 위치)
      summarySimpleMain.addEventListener('click', () => {
        const full = getFullBibleText();
        if (!full.trim()) { showModal("본문이 없습니다","요약할 성경 본문이 없습니다."); }
        else { fetchSummary(full, 'simple'); }
      });
      summaryDetailedMain.addEventListener('click', () => {
        const full = getFullBibleText();
        if (!full.trim()) { showModal("본문이 없습니다","요약할 성경 본문이 없습니다."); }
        else { fetchSummary(full, 'detailed'); }
      });

      // 모달 닫기
      closeModalButton.addEventListener('click', () => { 
        modal.style.display = 'none'; 
        document.body.classList.remove('modal-open'); // ✅ 추가
        });
      window.addEventListener('click', (ev) => { 
        if (ev.target === modal) {
        modal.style.display = 'none';
        document.body.classList.remove('modal-open'); // ✅ 추가
      }
    });

      // 선택 이벤트: 데스크탑 + 모바일 대응 (디바운스)
      const scheduleSelectionUpdate = () => {
        clearTimeout(selectionDebounce);
        selectionDebounce = setTimeout(handleSelectionChange, 160);
      };
      document.addEventListener('mouseup', scheduleSelectionUpdate, { passive:true });
      document.addEventListener('touchend', scheduleSelectionUpdate, { passive:true });
      document.addEventListener('selectionchange', scheduleSelectionUpdate);

      // 초기 speed 표시
      updateSpeed();
    });

    // --------------------------
    // 선택 관리: iOS에서 선택이 사라지는 문제를 보완
    function handleSelectionChange(){
      const sel = window.getSelection();
      if (!sel) return clearSelectionState();
      const text = (sel.toString() || "").trim();
      
      // 모달 위에서의 선택은 무시 (모달 내용 선택이 버튼을 호출하지 않도록)
      const modalEl = document.getElementById('explanation-modal');
      if (modalEl && modalEl.style.display === 'block') {
      const sel = window.getSelection();
      if (sel && (modalEl.contains(sel.anchorNode) || modalEl.contains(sel.focusNode))) return;
    }
      
      // 선택이 본문 내에 있는지 체크
      let isInBible = false;
      try {
        if (sel.anchorNode && sel.focusNode) {
          isInBible = bibleTextEl.contains(sel.anchorNode) && bibleTextEl.contains(sel.focusNode);
        }
      } catch(e){ isInBible = false; }

      if (text && isInBible) {
        selectedVerse = text;
        try {
          selectionRange = sel.getRangeAt(0).cloneRange();
        } catch(e){ selectionRange = null; }
        // 버튼 위치 표시
        try {
          const range = sel.getRangeAt(0);
          const rects = Array.from(range.getClientRects());
          const rect = rects.length
            ? rects.reduce((u, r) => ({
                top: Math.min(u.top, r.top),
                left: Math.min(u.left, r.left),
                right: Math.max(u.right, r.right),
                bottom: Math.max(u.bottom, r.bottom),
                width: 0, height: 0
        }), { top:Infinity, left:Infinity, right:-Infinity, bottom:-Infinity })
            : range.getBoundingClientRect();
            rect.width  = rect.right - rect.left;
            rect.height = rect.bottom - rect.top;
            positionExplanationButton(rect);
        } catch(e){
          // fallback: 고정 위치
          resetExplanationButton();
        }
      } else {
        clearSelectionState();
      }
    }
    function updateSelectedVerseFromRange(range) {
      if (!range) return;
      const txt = (range.toString() || "").trim();
      if (txt) selectedVerse = txt;
      // position button
      try {
        const rect = range.getBoundingClientRect();
        positionExplanationButton(rect);
      } catch(e){ resetExplanationButton(); }
    }
    
    function resetExplanationButton(){
      const container = document.getElementById('explanation-button-container');
      if (!container) return;
      // ‘초기 자리’로 이동 + 숨김
      container.style.position = 'fixed';
      container.style.left = '30%';
      container.style.top = '100px';
      container.style.transform = 'translateX(-50%)';
      container.style.display = 'block';
      explanationButtonWrapper.classList.remove('active');
    }
    
    function clearSelectionState(){
      selectedVerse = "";
      selectionRange = null;
      resetExplanationButton();
    }

    // 버튼 위치 설정 (화면 밖 방지 + 좌/우/중앙 규칙 + 위/아래 자동 배치)    
    function positionExplanationButton(rect){
  const container = document.getElementById('explanation-button-container');
  if (!container) return;

  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const margin = 8;
  const pad = 10;
  const viewportCenter = vw / 2;

  // 🔸 추가: 넓은 선택(화면의 60% 이상)은 무조건 중앙 정렬
  const isWide = rect.width >= vw * 0.6 || (rect.left <= margin*2 && rect.right >= vw - margin*2);

  let baseX, transformX;
  if (isWide) {
    baseX = rect.left + rect.width / 2;
    transformX = 'translateX(-50%)';
  } else if (rect.left < viewportCenter * 0.4) {
    baseX = rect.right;
    transformX = 'translateX(0)';
  } else if (rect.right > viewportCenter * 1.6) {
    baseX = rect.left;
    transformX = 'translateX(-100%)';
  } else {
    baseX = rect.left + rect.width / 2;
    transformX = 'translateX(-50%)';
  }

  // 이하 클램프/표시 로직은 기존 그대로 유지
  const cw = container.offsetWidth || 60;
  const ch = container.offsetHeight || 60;

  const leftEdge =
    transformX === 'translateX(0)'     ? baseX :
    transformX === 'translateX(-50%)'  ? baseX - cw/2 :
                                         baseX - cw;

  let clampedLeftEdge = Math.min(Math.max(leftEdge, margin), vw - margin - cw);

  let finalLeft;
  if (transformX === 'translateX(0)')        finalLeft = clampedLeftEdge;
  else if (transformX === 'translateX(-50%)') finalLeft = clampedLeftEdge + cw/2;
  else                                        finalLeft = clampedLeftEdge + cw;

  let finalTop = rect.bottom + pad;
  if (finalTop + ch + margin > vh) {
    finalTop = Math.max(rect.top - pad - ch, margin);
  }
  finalTop = Math.min(Math.max(finalTop, margin), vh - margin - ch);

  container.style.position = 'fixed';
  container.style.left = `${finalLeft}px`;
  container.style.top  = `${finalTop}px`;
  container.style.transform = transformX;
  container.style.display = 'block';
}
    
    // --------------------------
    // 검색 / 하이라이트 / 스크롤 마커
    function findString(searchText){
      clearHighlight();
      if (searchText == null || searchText.trim() === '') { searchCountEl.textContent = ''; nextLocationBtn.style.display = 'none'; return; }
      const escaped = escapeRegExp(searchText.trim());
      const regex = new RegExp(escaped, 'gi');
      const newContent = originalText.replace(regex, (match) => `<span class="search-highlight">${match}</span>`);
      bibleTextEl.innerHTML = newContent;
      foundSentences = Array.from(bibleTextEl.getElementsByClassName('search-highlight'));
      searchCountEl.textContent = `총 ${foundSentences.length}개 검색됨`;
      if (foundSentences.length > 0) {
        currentSearchIndex = 0;
        foundSentences[currentSearchIndex].scrollIntoView({ behavior:'smooth', block:'center' });
        nextLocationBtn.style.display = 'inline-block';
        updateScrollMarkers();
      } else {
        showModal("검색 결과 없음", `"${searchText}"에 대한 검색 결과가 없습니다.`);
        nextLocationBtn.style.display = 'none';
      }
    }
    function nextLocation(){
      if (!foundSentences.length) return;
      currentSearchIndex = (currentSearchIndex + 1) % foundSentences.length;
      foundSentences[currentSearchIndex].scrollIntoView({ behavior:'smooth', block:'center' });
      // 마커 동기화
      updateScrollMarkers();
    }
    function clearHighlight(){
      bibleTextEl.innerHTML = originalText;
      searchCountEl.textContent = '';
      nextLocationBtn.style.display = 'none';
      while (scrollMarkerContainer.firstChild) scrollMarkerContainer.removeChild(scrollMarkerContainer.firstChild);
      foundSentences = [];
      currentSearchIndex = -1;
    }
    function updateScrollMarkers(){
      while (scrollMarkerContainer.firstChild) scrollMarkerContainer.removeChild(scrollMarkerContainer.firstChild);
      const docH = document.documentElement.scrollHeight;
      const vh = window.innerHeight;
      foundSentences.forEach((el, idx) => {
        const marker = document.createElement('div');
        marker.className = 'scroll-marker';
        const topPos = el.getBoundingClientRect().top + window.scrollY;
        const markerPos = Math.min(Math.max((topPos / docH) * vh, 2), vh - 10);
        marker.style.top = markerPos + 'px';
        marker.addEventListener('click', () => { el.scrollIntoView({ behavior:'smooth', block:'center' }); });
        scrollMarkerContainer.appendChild(marker);
      });
    }

    // --------------------------
    // 모달
    function showModal(title, text, imageUrl=null){
      modalTitle.textContent = title || '';
      modalText.innerHTML = (text || '').toString().replace(/\n/g, '<br>');
      if (imageUrl) { modalImage.src = imageUrl; modalImage.style.display = 'block'; } else { modalImage.src=''; modalImage.style.display='none'; }
      modal.style.display = 'block';
      document.body.classList.add('modal-open'); // ✅ 추가

      // 선택영역 유지: 모달 열려도 선택 유지하도록 약간의 복원 시도
      setTimeout(() => {
        if (selectionRange) {
          const sel = window.getSelection();
          sel.removeAllRanges();
          try { sel.addRange(selectionRange); } catch(e) { /* ignore */ }
        }
      }, 60);
    }
    function showLoadingModal(isImage=false){
      modalTitle.innerHTML = `<span class="loader"></span> ${isImage ? '그림 생성 중...' : '설명 생성 중...'}`;
      modalText.textContent = '설명을 생성 중입니다. 잠시만 기다려 주세요...';
      modalImage.style.display = 'none';
      modal.style.display = 'block';
    }

    // --------------------------
    
    // 모달 내부에서 발생하는 휠은 바깥으로 전파되지 않게
    modal.addEventListener('wheel', (e) => {
      if (modal.style.display === 'block') e.stopPropagation();
    }, { passive: true });
    
    // 본문 전체 텍스트 획득 (요약용)
    function getFullBibleText(){
      const tmp = document.createElement('div');
      tmp.innerHTML = originalText;
      return tmp.textContent.replace(/\s+/g,' ').trim();
    }

    // --------------------------
    // 설명/요약 API 호출 (Generative API 호출 핸들러)
    async function callGenerativeAPI(modalTitleText, prompt){
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
      const payload = { contents: [ { parts: [ { text: prompt } ] } ] };

      let retryCount = 0; const maxRetries = 3;
      let response = null;
      while (retryCount < maxRetries) {
        try {
          response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          if (response.ok) break;
          if (response.status === 429) { retryCount++; const delay = Math.pow(2, retryCount)*1000 + Math.random()*1000; await new Promise(r=>setTimeout(r, delay)); }
          else throw new Error(`API Error: ${response.status} ${response.statusText}`);
        } catch (err) {
          console.error('API call failed:', err);
          showModal("오류 발생", "API 호출 중 오류가 발생했습니다. 다시 시도해 주세요.");
          return;
        }
      }
      if (!response || !response.ok) { showModal("오류", "설명을 불러오는 데 실패했습니다. 잠시 후 다시 시도해 주세요."); return; }

      try {
        const data = await response.json();
        const content = data?.candidates?.[0]?.content?.parts?.[0]?.text || "응답을 가져오지 못했습니다.";
        showModal(modalTitleText, content);
      } catch (err) {
        console.error('Error processing response:', err);
        showModal("오류", "응답을 처리하는 중 오류가 발생했습니다.");
      }
    }

    // fetchExplanation + fetchSummary
    async function fetchExplanation(promptText, type){
      let prompt;
      if (type === 'simple') {
        prompt = `[역할] 성경 주석가.
                  [작업] 선택한 용어/구절을 350–500자 한국어로 간결 설명.
                  [유형 규칙] 
                  - 지명: 위치·시대·관련 사건
                  - 인물: 이름의 뜻·역할·연관 지명
                  - 제사/성물: 용도·상징적 의미
                  - 동·식물·광물: 상징성
                  필요 시 대비/유사 2–12가지만 간단히. (이름↔지명 직접 연결이 있으면 함께 언급)
                  [금지] 장황함·추측·인용.
                  [입력] "${promptText}"`; 
      } else {
        prompt = `[역할] 성경 주석가.
                  [작업] 선택 구절을 2,500–3,500자 한국어 해설로 심화 분석.
                  [구성] 개요 → 배경(역사·지리·문화) → 본문 주제·핵심 논지 → 핵심 단어/도상 해석 
                        → 인물·사건·장소의 기능 → 성경 전체 맥락과의 연결(언약/교리, 유사·대조 2–12가지) 
                        → (선택) 3–6행 표로 요점 정리.
                  [규칙] 본문 근거 중심, 난해한 부분은 간명히, 과도한 인용/주석어/반복 금지, 분량 준수.
                  [긴 입력 시] 절/단락 단위로 요약 후 통합(최종 분량 준수).
                  [입력] "${promptText}"`;
      }
      showLoadingModal(false);
      await callGenerativeAPI('구절 설명', prompt);
    }

    async function fetchSummary(fullText, type){
      let prompt;
      if (type === 'simple') {
        prompt = `[역할] 성경 주석가.
                  [작업] 입력된 성경 본문 전체를 450–650자 한국어 한 단락으로 간결 요약.
                  [중점] 핵심 주제·메시지, 주요 사건 흐름, 하나님 행위/인간 반응. 배경은 필요한 한두 문장만. 삶에 적용되는 교훈이나 훈계를 간단히 2-3문장으로 추가.
                  [금지] 장황함·추측·인용·소제목·서론/결론 문구. 분량 엄수.
                  [긴 입력 시] 장(Chapter) 단위로 빠르게 요약→최종 450–650자로 통합.
                  [입력] "${fullText}"`; 
    } else {
        prompt = `[역할] 성경 주석가.
                  [작업] 입력 본문을 3,500–5,000자 한국어 해설로 정리.
                  [구성] 1) 개요  2) 배경(역사·지리·문화)  3) 핵심 주제/신학적 의미 
                        4) 인물·사건·장소의 역할  5) 성경 전체 맥락과 연결(필요 시 유사/대조 2–12가지)
                        6) (선택) 3–12행 표로 핵심 정리.  7) 결론
                        8) 삶에 적용되는 교훈이나 훈계를 간단히 4-5문장으로 추가.
                  [규칙] 사실 기반, 과장/추측/설교체 금지, 불필요한 반복·장목록 금지, 분량 준수.
                  [긴 입력 시] 장 단위로 개요→통합(최종 분량 준수).
                  [입력] "${fullText}"`;
      }

      showLoadingModal(false);
      await callGenerativeAPI('본문 요약', prompt);
    }

    // --------------------------
    // updateSpeed
    function updateSpeed(){ audio.playbackRate = currentSpeed; speedDisplay.textContent = currentSpeed.toFixed(1) + 'x'; }

    // --------------------------
    // 선택관련 helper (외부에서 range 직접 설정 등)
    // selectionRange는 이미 클론된 Range를 보유하거나 null
    // handleSelectionChange()에서 selectedVerse 업데이트

    // --------------------------
    // selection 유지 보장: 유저가 터치/클릭 후 선택이 사라지는 경우, 이전에 저장된 selectionRange를 복원 시도
    // 이 파일에서 selectionRange는 선택 직후 저장되며, 버튼 클릭 등으로 선택이 사라지면 복원 시도함.

    // --------------------------
    // 추가 유틸 (폰트 표시)
    function updateFontSizeDisplay(){
      const cur = parseFloat(getComputedStyle(bibleTextEl).fontSize);
      fontSizeEl.textContent = Math.round(cur);
    }

    // --------------------------
    // 안전한 context: window 전역에서 사용할 수 있도록 일부 함수 노출 (선택사항)
    window.findString = findString;
    window.nextLocation = nextLocation;

    // --------------------------
    // --- ✅ 새 토글 버튼 로직 ---
  const progressContainer = document.querySelector('.progress-container');
  const speedControls = document.querySelector('.speed-controls');
  const volumeControl = document.querySelector('.volume-control');
  const showProgressBtn = document.getElementById('show-progress');
  const showSpeedBtn = document.getElementById('show-speed');
  const showVolumeBtn = document.getElementById('show-volume');

  let hideTimeout;

  function showOnly(target) {
    progressContainer.style.display = "none";
    speedControls.style.display = "none";
    volumeControl.style.display = "none";

    target.style.display = "flex";

    if (hideTimeout) clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
      target.style.display = "none";
    }, 10000);
  }

  showProgressBtn.addEventListener('click', () => showOnly(progressContainer));
  showSpeedBtn.addEventListener('click', () => showOnly(speedControls));
  showVolumeBtn.addEventListener('click', () => showOnly(volumeControl));
  </script>
</body>
</html>
