<!DOCTYPE html>
try { aPoint = Math.max(0, player.getCurrentTime?.() || 0); } catch { aPoint = 0; }
if (bPoint != null && bPoint <= aPoint) { bPoint = null; }
updateABUI();
if (abEnabled) { try { player.seekTo(aPoint, true); } catch {} }
updateShareLink(currentVideoId || '');
}


function setBHere() {
const dur = player?.getDuration?.() || 0;
try { bPoint = Math.min(dur || Infinity, player.getCurrentTime?.() || 0); } catch { bPoint = null; }
if (aPoint == null) { showError('먼저 A 지점을 설정해 주세요.'); return; }
if (bPoint != null && bPoint <= aPoint) { showError('B는 A보다 커야 합니다.'); bPoint = null; }
updateABUI();
updateShareLink(currentVideoId || '');
}


function toggleABLoop() {
if (!abEnabled) {
if (aPoint == null || bPoint == null || bPoint <= aPoint) { showError('A와 B를 올바르게 설정해 주세요.'); return; }
abEnabled = true;
try { player.seekTo(aPoint, true); player.playVideo(); } catch {}
} else {
abEnabled = false;
}
updateABUI();
updateShareLink(currentVideoId || '');
}


function clearAB() {
aPoint = null; bPoint = null; abEnabled = false;
updateABUI();
updateShareLink(currentVideoId || '');
}


// ====== 이벤트 바인딩 ======
els.loadBtn.addEventListener('click', () => {
const id = extractYouTubeId(els.urlInput.value);
if (!id) return showError('유효한 유튜브 링크(또는 영상 ID)를 입력해 주세요.');
loadVideo(id);
});
els.urlInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') els.loadBtn.click(); });


els.overlayPlay.addEventListener('click', () => { try { player.playVideo(); } catch {} });
els.play.addEventListener('click', () => { try { player.playVideo(); } catch {} });
els.pause.addEventListener('click', () => { try { player.pauseVideo(); } catch {} });
els.stop.addEventListener('click', () => { try { player.stopVideo(); player.seekTo(0, true); toggleOverlay(true); } catch {} });


els.back5.addEventListener('click', () => { try { const t = Math.max(0, (player.getCurrentTime?.() || 0) - 5); player.seekTo(t, true); } catch {} });
els.fwd5.addEventListener('click', () => { try { const dur = player.getDuration?.() || 0; const t = Math.min(dur, (player.getCurrentTime?.() || 0) + 5); player.seekTo(t, true); } catch {} });


els.vol.addEventListener('input', (e) => setVolume(e.target.value));


// Seek 슬라이더 드래그 핸들링
els.seek.addEventListener('input', () => { userDragging = true; const dur = player?.getDuration?.() || 0; const pos = Number(els.seek.value) / 1000; const t = dur * pos; els.cur.textContent = formatTime(t); });
els.seek.addEventListener('change', () => { const dur = player?.getDuration?.() || 0; const pos = Number(els.seek.value) / 1000; const t = dur * pos; try { player.seekTo(t, true); } catch {} userDragging = false; });


// 공유 주소 복사
els.copy.addEventListener('click', async () => {
try { await navigator.clipboard.writeText(els.share.value); els.copy.textContent = '복사됨!'; setTimeout(() => (els.copy.textContent = '주소 복사'), 1500); }
catch { els.share.select(); document.execCommand('copy'); els.copy.textContent = '복사됨!'; setTimeout(() => (els.copy.textContent = '주소 복사'), 1500); }
});


// A–B 버튼 & 단축키
els.setA.addEventListener('click', setAHere);
els.setB.addEventListener('click', setBHere);
els.toggleAB.addEventListener('click', toggleABLoop);
els.clearAB.addEventListener('click', clearAB);


document.addEventListener('keydown', (e) => {
const tag = document.activeElement?.tagName;
if (tag === 'INPUT' || tag === 'TEXTAREA') return; // 입력 중엔 단축키 무시
const k = e.key.toLowerCase();
if (k === 'a') setAHere();
else if (k === 'b') setBHere();
else if (k === 'l') toggleABLoop();
else if (k === 'c') clearAB();
});
</script>
</body>
</html>
